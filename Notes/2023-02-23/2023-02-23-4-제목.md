---
title: 4. 예제
---

# 예제

### 목표

1. log4j
2. @Controller
3. @RequestMapping
4. InternalResourceView Class
5. Model, ModelAndView

### log4j

System.out.println()을 이용해 출력하는 방식은 성능면, 관리면 등 여러 측면에서 좋지 않음.
1. 성능 측면: 성능을 저하시킴
2. 관리적 측면: 배포시 지워야 함
3. 운영 측면: 로그가 있어야 장애 추적이 가능

spring에서는 log4j를 쉽게 이용할 수 있음. STS 사용시 프로젝트 생성만 해도 세팅이 되어있음.

그런데 얼마 전 취약점이 발견되어 난리가 난 적이 있음.  
log4j(1.x)의 대안으로 log4j2 (2.x)나 logback(spring boot)을 사용할 수도 있음.

우리는 먼저 log4j 1.x를 사용해보고, 이후 log4j2를 사용해보려고 한다.

### log4j 1 설정

log4j.xml (src/main/resources)

다만 지금은 기본 스프링 Web MVC 프로젝트이므로, log4j 1.x가 기본으로 되어 있어서, log4j 설정에 대한 설정은 없다.

- \<appender>
    - 로그의 출력 위치를 지정. 콘솔/DB/파일 등 어디에 저장할지를 정할 수 있음
    - name은 임의로 지정. class는 정해져 있음.
    - \<param>에는 출력 위치를 직접 지정
    - \<layout>에는 로그를 어떤 형식으로 출력할지를 지정. class는 정해져 있음.
        - %p, %c, %m, %n 등의 문자를 통해 레이아웃의 패턴을 정할 수 있음.

```xml
<!-- Appenders -->
<appender name="console" class="org.apache.log4j.ConsoleAppender">
    <param name="Target" value="System.out" />
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%-5p: %c - %m%n" />
    </layout>
</appender>
```



- \<logger>
    - logging 메시지를 \<appender>에 전달하는 역할  
    - log에는 출력 레벨이 있음. (총 6단계) 출력 레벨에 따라 출력 여부를 결정.

```xml
	<!-- Application Loggers -->
	<logger name="my.spring.springweb">
		<level value="info" />
	</logger>
	
	<!-- 3rdparty Loggers -->
	<logger name="org.springframework.core">
		<level value="info" />
	</logger>
	
	<logger name="org.springframework.beans">
		<level value="info" />
	</logger>
	
	<logger name="org.springframework.context">
		<level value="info" />
	</logger>

	<logger name="org.springframework.web">
		<level value="info" />
	</logger>
```


#### \<appender>

출력 위치를 지정하는 것이므로 종류가 여러개임
- ConsoleAppender:콘솔에 출력. 디버깅에 많이 사용.
- FileAppender:파일에 출력
- RollingFileAppender: 단일 파일에 로그 기록시 용량이 엄청 커질 것임. 이 어펜더를 사용하면 로그 파일의 용량을 제한하여, 용량이 초과하면 새로운 로그를 만들어 기록 시작
- DaillyRollingAppender: 로그를 날짜별 파일에 출력

#### \<layout>

포맷을 잡는 곳. 

- %p: 로그의 레벨 (전체 레벨은 6단계)
    - FATAL (가장 심각): 시스템에 심각한 문제가 있음. 스프링의 로그인 경우 이 에러가 나면 직후에 스프링이 감... 
    - ERROR: 실행중 에러가 발생함
    - WARN: 오류의 원인이 될 수 있는 경우
    - INFO: 서비스 운영에 대한 정보.
    - DEBUG: 개발 중 디버깅 목적으로 찍는 정보.
    - TRACE DEBUG의 상세 정보
- %m: 로그 메시지
- %d: 로그 발생 시간 (yyyy-mm-dd HH:mm:ss)
- %c: 로그를 발생시킨 클래스 위치
- %n: 개행

%-5p: %p 들여쓰기 적용


#### \<logger>

```xml
	<logger name="my.spring.springweb">
		<level value="info" />
	</logger>
```
my.spring.springweb에서 발생하는 info 이상 로그를 출력. 그럼 debug, trace는 안찍히게 됨.

#### \<root>

```xml
<!-- Root Logger -->
<root>
    <priority value="warn" />
    <appender-ref ref="console" />
</root>
```

가장 하단에 어펜더를 가리키는 \<root>가 있다.  
여기서 전역적인 레벨도 지정 가능한데, 상단의 \<logger>에서 지정한 세부 설정이 더 우선한다.

### 프로젝트에 적용

```xml
<!-- Appenders -->
<appender name="console" class="org.apache.log4j.ConsoleAppender">
    <param name="Target" value="System.out" />
    <layout class="org.apache.log4j.PatternLayout">
        <!-- <param name="ConversionPattern" value="%-5p: %c - %m%n" /> -->
        <param name="ConversionPattern" value="%-5p: [%d] %c - %m%n" /> <!-- 로그발생일시를 같이 출력 -->
    </layout>
</appender>

<!-- Application Loggers -->
<logger name="my.spring.springweb">
    <level value="debug" /> <!-- DEBUG 레벨 이상을 출력하도록 지정 -->
</logger>
```

로그 출력 레이아웃에 출력 일시를 추가했고, 로그 출력 레벨을 debug 이상으로 변경했다.