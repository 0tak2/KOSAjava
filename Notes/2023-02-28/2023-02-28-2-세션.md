---
title: 2. 세션
---

# 세션

## 세션 객체

정확히는 HttpSession.  
Request.getSession()을 통해 얻어올 수 있었음.

스프링프레임워크에서도 이렇게 하면 안된다는 것은 아니지만, 매번 같은 코드를 중복적으로 사용해야함. 대안으로 세션을 편하게 사용할 수 있도록 한 것이 @SessionAttributes (@SessionAttribute와 혼동 주의. 역할이 다름)

- @SessionAttributes
    - 세션에 값을 저장하거나 찾을 수 있도록 지정. 이 어노테이션이 일을 하는 것이 아니라, 이걸 붙여놓으면 세션에서 찾거나 저장하는 것이 가능해짐
    - 위치: 컨트롤러 위에 붙임
- @SessionAttribute
    - 필터 등 컨트롤러 외부에서 세션으로 저장한 객체를 사용하기 위해 사용
    - 위치: 메서드(핸들러, 일반 메서드) 인자 앞에 붙임
    - 쓸 일이 많지는 않음

## 실습 1: 리퀘스트 스코프

#### HTML 및 JS 설정

resources/sample07/sessionForm.html

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="../js/common.js"></script>
</head>
<body>

</body>
</html>
```

&nbsp;

resources/sample07/js/common.js

#### HTML 작성

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="../js/common.js"></script>
</head>
<body>
	<h1>학생 정보 등록</h1>
	<hr>
	<form id="myForm" action="" method="post">
		Action:
		<select>
			<option selected="selected">/springweb/sessionAttributesTest01</option>
			<option>/springweb/sessionAttributesTest02</option>
			<option>/springweb/sessionAttributesTest03</option>
			<option>/springweb/sessionAttributesTest04</option>
			<option>/springweb/sessionAttributesTest05</option>
			<option>/springweb/sessionAttributesTest06</option>
			<option>/springweb/sessionAttributesTest07</option>
		</select>
		<br><br>
		
		전달할 메시지: <input type="text" name="msg"><br>
		
		학생 번호: <input type="number" name="studentNumber"><br>
		
		학생 이름: <input type="text" name="studentName"><br>
		
		학생 이름: <input type="text" name="studentDept"><br>
		<br><br>
		
		<input type="submit" value="등록" onclick="myFunc()">
		
	</form>
</body>
</html>
```

```javascript
function myFunc() {
	// 사용자가 선택한 URL을 form의 action에 지정
	let url = $('#myForm > select > option:selected').text();
	$('#myForm').attr('action', url);
	// 이후 디폴트 이벤트가 발동되어 submit됨
}
```

#### vo 작성

커맨드 객체로 사용할 VO 작성

![2bb9452b4644c029d9d3e663053c5723.png](Assets/2bb9452b4644c029d9d3e663053c5723.png)

```java
package my.spring.springweb.sample07.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class Student {

	// 커맨드 객체로 쓸 것이기 때문에
	// 클라이언트 측 폼 name과 필드명이 같아야 함

	private int studentNumber;
	private String studentName;
	private String studentDept;
}

```

#### 컨트롤러 생성

```java
package my.spring.springweb.sample07;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import my.spring.springweb.sample07.vo.Student;

@Controller
@RequestMapping(value = "sessionAttributesTest01")
public class SessionAttributeController01 {

	Logger log = LogManager.getLogger("case3");
	
	// 핸들러 호출 직전 아래 메서드가 호출됨
	// 아래 메서드의 리턴값이 모델에 저장됨. key는 "data1"
	@ModelAttribute("data1")
	public String createString1() {
		log.debug("[Invoked] createString1");
		return "createString1";
	}
	
	// 역시 핸들러 호출 직전 아래 메서드가 호출됨
	// createString1, createString2 간 호출 순서는 알 수 없음.
	@ModelAttribute("data2")
	public String createString2() {
		log.debug("[Invoked] createString2");
		return "createString2";
	}	
	
	@PostMapping
	public String handler(@ModelAttribute("data1") String str1,
			@ModelAttribute("data2") String str2, // 위의 리턴값을 인자로 주입받음
			@RequestParam(value = "msg") String strFromReq, // 리퀘스트 오는 데이터 중 VO에 없는 것
			@ModelAttribute("newStudent") Student studentVO) { // 레퀘스트 데이터를 VO로 받음 (키값 지정)
		
		log.debug("[Invoked] handler(): " + str1 + ", " + str2);
		log.debug("\t msg: " + strFromReq);
		log.debug("\t student: " + studentVO);
		
		return "sample07/sessionResult01";
	}
}

```

#### JSP 작성

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>수행된 결과</h1>
	<h2>RequestScope</h2>
	<ul>
		<li>requestScope.data1: ${ requestScope.data1 }</li> <!-- createString1 -->
		<li>requestScope.data2: ${ requestScope.data2 }</li> <!-- createString2 -->
		<li>param.msg: ${ param.msg }</li>
		<li>requestScope.studentVO: ${ requestScope.studentVO }</li>
		<li>requestScope.student: ${ requestScope.student }</li>
		<li>requestScope.newStudent: ${ requestScope.newStudent }</li>
	</ul>
</body>
</html>
```

![2d9a25fd7c6ed8b71e2d643ced551344.png](Assets/2d9a25fd7c6ed8b71e2d643ced551344.png)

![c1fc8d2810f3028c9a9c28c2f312ce77.png](Assets/c1fc8d2810f3028c9a9c28c2f312ce77.png)

리퀘스트 스코프의 값이므로 요청이 소멸되면 사라짐.

## 실습 2: 세션 스코프

### 2-1

컨트롤러를 수정해본다.

클래스 레벨에 @SessionAttributes를 달아보자.

```
@SessionAttributes(value = {"a", "b", "c"})
```

위와 같이 쓰면, 모델에 a, b, c 키로 저장되는 데이터가 세션에도 저장된다.  'value ='은 생략할 수 있다. 


```java
@Controller
@SessionAttributes({"data1"})
@RequestMapping(value = "sessionAttributesTest01")
public class SessionAttributeController01 {
    
    // 후략
```

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>수행된 결과</h1>
	<h2>RequestScope</h2>
	<ul>
		<li>requestScope.data1: ${ requestScope.data1 }</li> <!-- createString1 -->
		<li>requestScope.data2: ${ requestScope.data2 }</li> <!-- createString2 -->
		<li>param.msg: ${ param.msg }</li>
		<li>requestScope.studentVO: ${ requestScope.studentVO }</li>
		<li>requestScope.student: ${ requestScope.student }</li>
		<li>requestScope.newStudent: ${ requestScope.newStudent }</li>
	</ul>
	<h2>SessionScope</h2>
	<ul>
		<li>sessionScope.data1: ${ requestScope.data1 }</li> <!-- createString1 -->
		<li>sessionScope.data2: ${ requestScope.data2 }</li> <!-- createString2 -->
		<li>sessionScope.newStudent: ${ requestScope.newStudent }</li>
	</ul>
</body>
</html>
```

![630594f21f1f3efd91b02c99f1b68fe6.png](Assets/630594f21f1f3efd91b02c99f1b68fe6.png)

### 2-2

#### 세션을 직접 다루는 것과 @SessionAttributes를 통해 다루는 것의 차이

```java
	@ModelAttribute("data2")
	public String createString2(HttpServletRequest request) {
		// 세션 직접 이용
		//	true => 접속 클라리언트에 대한 세션이 없으면 만들고 레퍼런스를 가져옴.
		//			있으면 레퍼런스만 가져옴.
		HttpSession session = request.getSession(true);
		Student student = new Student(30, "신사임당", "국어국문");
		session.setAttribute("currentStudent", student); 
		
		log.debug("[Invoked] createString2");
		return "createString2";
	}	
```

이 작업은 세션을 직접 다루며, 세션 내의 모든 객체에 접근할 수 있다. @SessionAttributes를 쓰면 지정한 특정 어트리뷰트에만 접근할 수 있으며 세션 자체에는 접근할 수 없다.

#### 테스트 1
직전의 컨트롤러를 02로 복사한다.  
직전의 JSP도 02를 붙여 복사한다.

```java
	@ModelAttribute("data2")
	public String createString2(HttpServletRequest request) {
		// 세션 직접 이용
		//	true => 접속 클라리언트에 대한 세션이 없으면 만들고 레퍼런스를 가져옴.
		//			있으면 레퍼런스만 가져옴.
		HttpSession session = request.getSession(true);
		Student student = new Student(30, "신사임당", "국어국문");
		session.setAttribute("currentStudent", student); 
		
		log.debug("[Invoked] createString2");
		return "createString2";
	}	
	
	@PostMapping
	public String handler(@ModelAttribute("data1") String str1,
			@ModelAttribute("data2") String str2, // 위의 리턴값을 인자로 주입받음
			@RequestParam(value = "msg") String strFromReq, // 리퀘스트 오는 데이터 중 VO에 없는 것
			@ModelAttribute("newStudent") Student studentVO) { // 레퀘스트 데이터를 VO로 받음 (키값 지정)
		
		log.debug("[Invoked] handler(): " + str1 + ", " + str2);
		log.debug("\t msg: " + strFromReq);
		log.debug("\t student: " + studentVO);
		
		return "sample07/sessionResult02";
	}
```

![3dd2e7610d0c927fffdd0baecb95a971.png](Assets/3dd2e7610d0c927fffdd0baecb95a971.png)




#### 테스트 2

03으로 컨트롤러와 JSP를 복사한다.

```java
package my.spring.springweb.sample07;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.SessionAttributes;

import my.spring.springweb.sample07.vo.Student;

@Controller
@SessionAttributes({"data1", "shin"})
@RequestMapping(value = "/sessionAttributesTest03")
public class SessionAttributeController03 {

	Logger log = LogManager.getLogger("case3");
	
	@ModelAttribute("data1")
	public String createString1() {
		log.debug("[Invoked] createString1");
		return "createString1";
	}
	
	@ModelAttribute("shin")
	public Student createString2(HttpServletRequest request) {
		// 세션 직접 이용
		//	true => 접속 클라리언트에 대한 세션이 없으면 만들고 레퍼런스를 가져옴.
		//			있으면 레퍼런스만 가져옴.
		HttpSession session = request.getSession(true);
		Student student = new Student(30, "신사임당", "국어국문");
		
		log.debug("[Invoked] createString2");
		return student;
	}	
	
	@PostMapping
	public String handler(@ModelAttribute("data1") String str1,
			@ModelAttribute("data2") String str2, // 위의 리턴값을 인자로 주입받음
			@RequestParam(value = "msg") String strFromReq, // 리퀘스트 오는 데이터 중 VO에 없는 것
			@ModelAttribute("newStudent") Student studentVO) { // 레퀘스트 데이터를 VO로 받음 (키값 지정)
		
		log.debug("[Invoked] handler(): " + str1 + ", " + str2);
		log.debug("\t msg: " + strFromReq);
		log.debug("\t student: " + studentVO);
		
		return "sample07/sessionResult03";
	}
}

```

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>수행된 결과</h1>
	<h2>RequestScope</h2>
	<ul>
		<li>requestScope.data1: ${ requestScope.data1 }</li> <!-- createString1 -->
		<li>requestScope.data2: ${ requestScope.data2 }</li> <!-- createString2 -->
		<li>param.msg: ${ param.msg }</li>
		<li>requestScope.studentVO: ${ requestScope.studentVO }</li>
		<li>requestScope.student: ${ requestScope.student }</li>
		<li>requestScope.newStudent: ${ requestScope.newStudent }</li>
	</ul>
	<h2>SessionScope</h2>
	<ul>
		<li>sessionScope.data1: ${ sessionScope.data1 }</li> <!-- createString1 -->
		<li>sessionScope.data2: ${ sessionScope.data2 }</li> <!-- createString2 -->
		<li>sessionScope.newStudent: ${ sessionScope.newStudent }</li>
		<li>sessionScope.shin.stduentName: ${ sessionScope.shin.studentName }</li>
		<li>sessionScope.shin.studentDept: ${ sessionScope.shin.studentDept }</li>
	</ul>
</body>
</html>
```

@SessionAttributes({ "shin"})를 사용하여 값을 모델과 세션 동시에 저장하였다.  
앞으로는 어지간하면 세션을 직접 다루지 않고 이 방법을 이용한다.